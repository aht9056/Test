"use strict";(self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[]).push([[814],{3255:function(e,t,s){s.r(t),s.d(t,{default:function(){return g}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container-fluid layout w-100"},[t("article",{staticClass:"l-design-width"},[t("div",{staticClass:"card row flex-row"},[t("div",{staticClass:"col-lg-6 col-12"},[t("div",{staticClass:"d-flex justify-content-between"},[t("h3",[e._v("書籍資料")]),t("button",{on:{click:function(t){return e.checkBookData()}}},[e._v("檢查")])]),t("div",{staticClass:"input"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookData.name,expression:"bookData.name"}],staticClass:"input__field",attrs:{type:"text",placeholder:""},domProps:{value:e.bookData.name},on:{input:function(t){t.target.composing||e.$set(e.bookData,"name",t.target.value)}}}),t("span",{staticClass:"input__label"},[e._v("書籍名稱")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.name))])]),t("div",{staticClass:"input"},[t("div",{staticClass:"input__field h-100 d-flex flex-wrap"},[t("div",{staticClass:"form-check col-6"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.isForeign,expression:"bookMessage.isForeign"}],staticClass:"form-check-input",attrs:{type:"radio",name:"languageRadio",id:"isForeignRadio_false"},domProps:{value:!1,checked:e._q(e.bookMessage.isForeign,!1)},on:{change:function(t){return e.$set(e.bookMessage,"isForeign",!1)}}}),t("label",{staticClass:"form-check-label",attrs:{for:"isForeignRadio_false"}},[e._v(" 中文 ")])]),t("div",{staticClass:"form-check col-6"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.isForeign,expression:"bookMessage.isForeign"}],staticClass:"form-check-input",attrs:{type:"radio",name:"languageRadio",id:"isForeignRadio_true"},domProps:{value:!0,checked:e._q(e.bookMessage.isForeign,!0)},on:{change:function(t){return e.$set(e.bookMessage,"isForeign",!0)}}}),t("label",{staticClass:"form-check-label",attrs:{for:"isForeignRadio_true"}},[e._v(" 外文 ")])])]),t("span",{staticClass:"input__label"},[e._v("語言分類")])]),t("div",{staticClass:"input"},[t("div",{staticClass:"input__field d-flex flex-wrap"},e._l(Object.keys(e.typeList),(function(s,o){return t("div",{key:s,staticClass:"form-check col-12 col-sm-12 col-md-6 col-lg-3"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.type,expression:"bookMessage.type"}],staticClass:"form-check-input",attrs:{type:"radio",name:"typeRadio",id:"typeRadio_"+o},domProps:{value:s,checked:e._q(e.bookMessage.type,s)},on:{change:[function(t){return e.$set(e.bookMessage,"type",s)},function(t){return e.changeTypeRadio(s)}]}}),t("label",{staticClass:"form-check-label",attrs:{for:"typeRadio_"+o}},[e._v(" "+e._s(e.typeList[s].name)+" ")])])})),0),t("span",{staticClass:"input__label"},[e._v("主類型")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.type))])]),t("div",{staticClass:"input"},[t("div",{staticClass:"input__field d-flex flex-wrap"},e._l(e.nowSubTypesInfo,(function(s,o){return t("div",{staticClass:"form-check col-12 col-sm-12 col-md-6 col-lg-3"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.subTypes,expression:"bookMessage.subTypes"}],staticClass:"form-check-input",attrs:{type:"checkbox",name:"subTypeCheckBox",id:"subTypeCheckBox_"+o},domProps:{value:s,checked:Array.isArray(e.bookMessage.subTypes)?e._i(e.bookMessage.subTypes,s)>-1:e.bookMessage.subTypes},on:{change:function(t){var o=e.bookMessage.subTypes,a=t.target,i=!!a.checked;if(Array.isArray(o)){var r=s,n=e._i(o,r);a.checked?n<0&&e.$set(e.bookMessage,"subTypes",o.concat([r])):n>-1&&e.$set(e.bookMessage,"subTypes",o.slice(0,n).concat(o.slice(n+1)))}else e.$set(e.bookMessage,"subTypes",i)}}}),t("label",{staticClass:"form-check-label",attrs:{for:"subTypeCheckBox_"+o}},[e._v(" "+e._s(s)+" ")])])})),0),t("span",{staticClass:"input__label"},[e._v("子類型")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.subTypes))])]),t("div",{staticClass:"input"},[t("div",{staticClass:"input__field d-flex flex-wrap"},[t("TagInput",{on:{input:function(e){}},model:{value:e.bookMessage.bookTag,callback:function(t){e.$set(e.bookMessage,"bookTag",t)},expression:"bookMessage.bookTag"}})],1),t("span",{staticClass:"input__label"},[e._v("書籍標籤")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.bookTag))])]),t("div",{staticClass:"input",on:{click:function(t){return e.getDescription("book")}}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.description,expression:"bookMessage.description"}],staticClass:"input__field",attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:e.bookMessage.description},on:{input:function(t){t.target.composing||e.$set(e.bookMessage,"description",t.target.value)}}}),t("span",{staticClass:"input__label"},[e._v("書籍介紹")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.description))])]),t("div",{staticClass:"input"},[t("div",{staticClass:"input__field d-flex flex-wrap flex-column"},[t("UploadPicture",{attrs:{images:e.images},on:{"files-selected":e.handleImages}})],1),t("span",{staticClass:"input__label"},[e._v("圖片")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.photo))])]),t("div",{staticClass:"input"},[t("div",{staticClass:"input__field d-flex flex-wrap flex-column"},[t("UploadPdf",{attrs:{nowfile:e.pdfFile},on:{"file-selected":e.handlePdf}})],1),t("span",{staticClass:"input__label"},[e._v("書籍pdf檔")])])]),t("div",{staticClass:"col-lg-6 col-12"},[t("h2",[e._v("出版資料")]),t("div",{staticClass:"input"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.code,expression:"bookMessage.code"}],staticClass:"input__field",attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:e.bookMessage.code},on:{input:function(t){t.target.composing||e.$set(e.bookMessage,"code",t.target.value)}}}),t("span",{staticClass:"input__label"},[e._v("出版社代號")])]),t("div",{staticClass:"input"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.nowPublisher.name,expression:"nowPublisher.name"}],staticClass:"input__field",attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:e.nowPublisher.name},on:{input:function(t){t.target.composing||e.$set(e.nowPublisher,"name",t.target.value)}}}),t("span",{staticClass:"input__label"},[e._v("出版社名稱")])]),t("div",{staticClass:"input"},[t("div",{staticClass:"input__field d-flex flex-wrap"},[t("PickDate",{model:{value:e.bookMessage.publicationDate,callback:function(t){e.$set(e.bookMessage,"publicationDate",t)},expression:"bookMessage.publicationDate"}})],1),t("span",{staticClass:"input__label"},[e._v("出版日期")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.publicationDate))])]),t("div",{staticClass:"input"},[t("div",{staticClass:"input__field d-flex flex-wrap"},[t("TagInput",{attrs:{suggestions:[]},on:{input:function(e){}},model:{value:e.bookMessage.author,callback:function(t){e.$set(e.bookMessage,"author",t)},expression:"bookMessage.author"}})],1),t("span",{staticClass:"input__label"},[e._v("作者")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.author))])]),t("div",{staticClass:"input",on:{click:function(t){return e.getDescription("author")}}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookData.authorIntro,expression:"bookData.authorIntro"}],staticClass:"input__field",attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:e.bookData.authorIntro},on:{input:function(t){t.target.composing||e.$set(e.bookData,"authorIntro",t.target.value)}}}),t("span",{staticClass:"input__label"},[e._v("作者介紹")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.authorIntro))])]),t("h2",[e._v("販售資料")]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.saleType))]),t("div",{staticClass:"input d-flex justify-content-between"},[t("div",{staticClass:"mt-1 input flex-grow-1"},[t("div",{staticClass:"input__field h-100 d-flex flex-wrap"},[t("div",{staticClass:"form-check col-6"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.entity,expression:"bookMessage.entity"}],staticClass:"form-check-input",attrs:{type:"radio",name:"entityRadio",id:"entityRadio_true"},domProps:{value:!0,checked:e._q(e.bookMessage.entity,!0)},on:{change:function(t){return e.$set(e.bookMessage,"entity",!0)}}}),t("label",{staticClass:"form-check-label",attrs:{for:"entityRadio_true"}},[e._v(" 有販售 ")])]),t("div",{staticClass:"form-check col-6"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.entity,expression:"bookMessage.entity"}],staticClass:"form-check-input",attrs:{type:"radio",name:"entityRadio",id:"entityRadio_false"},domProps:{value:!1,checked:e._q(e.bookMessage.entity,!1)},on:{change:function(t){return e.$set(e.bookMessage,"entity",!1)}}}),t("label",{staticClass:"form-check-label",attrs:{for:"entityRadio_false"}},[e._v(" 無販售 ")])])]),t("span",{staticClass:"input__label"},[e._v("實體書")])]),e.bookMessage.entity?t("div",{staticClass:"mt-1 ms-1 input flex-grow-1"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.entityPrice,expression:"bookMessage.entityPrice"}],staticClass:"input__field h-100",attrs:{type:"number",placeholder:""},domProps:{value:e.bookMessage.entityPrice},on:{input:function(t){t.target.composing||e.$set(e.bookMessage,"entityPrice",t.target.value)}}}),t("span",{staticClass:"input__label"},[e._v("定價")])]):e._e(),e.bookMessage.entity?t("div",{staticClass:"mt-1 ms-1 input flex-grow-1"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.stock,expression:"bookMessage.stock"}],staticClass:"input__field h-100",attrs:{type:"number",placeholder:""},domProps:{value:e.bookMessage.stock},on:{input:function(t){t.target.composing||e.$set(e.bookMessage,"stock",t.target.value)}}}),t("span",{staticClass:"input__label"},[e._v("庫存")])]):e._e()]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.entityPrice))]),t("div",{staticClass:"input d-flex justify-content-between"},[t("div",{staticClass:"mt-1 input flex-grow-1"},[t("div",{staticClass:"input__field h-100 d-flex flex-wrap"},[t("div",{staticClass:"form-check col-6"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.ebook,expression:"bookMessage.ebook"}],staticClass:"form-check-input",attrs:{type:"radio",name:"eBookRadio",id:"eBookRadio_true"},domProps:{value:!0,checked:e._q(e.bookMessage.ebook,!0)},on:{change:function(t){return e.$set(e.bookMessage,"ebook",!0)}}}),t("label",{staticClass:"form-check-label",attrs:{for:"eBookRadio_true"}},[e._v(" 有販售 ")])]),t("div",{staticClass:"form-check col-6"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.ebook,expression:"bookMessage.ebook"}],staticClass:"form-check-input",attrs:{type:"radio",name:"eBookRadio",id:"eBookRadio_false"},domProps:{value:!1,checked:e._q(e.bookMessage.ebook,!1)},on:{change:function(t){return e.$set(e.bookMessage,"ebook",!1)}}}),t("label",{staticClass:"form-check-label",attrs:{for:"eBookRadio_false"}},[e._v(" 無販售 ")])])]),t("span",{staticClass:"input__label"},[e._v("電子書")])]),e.bookMessage.ebook?t("div",{staticClass:"mt-1 ms-1 input flex-grow-1"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.bookMessage.ebookPrice,expression:"bookMessage.ebookPrice"}],staticClass:"input__field h-100",attrs:{type:"number",placeholder:""},domProps:{value:e.bookMessage.ebookPrice},on:{input:function(t){t.target.composing||e.$set(e.bookMessage,"ebookPrice",t.target.value)}}}),t("span",{staticClass:"input__label"},[e._v("定價")])]):e._e()]),t("small",{staticClass:"errorhint"},[e._v(e._s(e.errorHint.ebookPrice))])]),t("div",{staticClass:"col-lg-12 col-12 d-flex flex-row-reverse"},[t("button",{on:{click:function(t){return e.addBook()}}},[e._v("送出")])])])])])},a=[],i=(s(4114),s(9470)),r=s(7797),n=s(902),l=s(3753),c=s(2187),u=s(3954),d=s(8704),p={components:{TagInput:r.A,SelectInput:n.A,PickDate:l.A,UploadPicture:c.A,UploadPdf:u.A},data(){return{bookData:{serialNumber:"",name:"",pdf:"",authorIntro:""},bookMessage:{code:"",name:"",type:"T001",subTypes:[],publisherName:"",publicationDate:"",isForeign:!1,serialNumber:"",fixMessage:"",read:!1,forSale:!1,lastUpdateTime:"",createTime:"",option:"addBook",status:"審核中",views:0,sold:0,author:[],description:"",bookTag:[],ebook:!1,entity:!0,entityPrice:0,ebookPrice:0,stock:0,discount:80,saleTag:[],contentPagePhoto:[]},nowPublisher:{},images:[],typeList:{},nowSubTypesInfo:[],errorHint:{name:"",type:"",subTypes:"",author:"",code:"",photo:"",publicationDate:"",description:"",bookTag:"",authorIntro:"",stock:"",entityPrice:"",ebookPrice:"",saleType:""},pdfFile:null}},computed:{},methods:{getTypeList(){this.typeList=this.$store.state.generalInfo.typeList,this.changeTypeRadio(this.bookMessage.type)},changeTypeRadio(e){this.bookMessage.subTypes=[],this.nowSubTypesInfo=this.typeList[e].subTypes},handleDatePick(e){this.bookMessage.publicationDate=e},handleImages(e){this.images=e},handlePdf(e){this.pdfFile=e},getDescription(e){let t="";t="book"==e?this.bookMessage.description:this.bookData.authorIntro,this.$swal.fire({title:"請填寫介紹內文",html:`<textarea id="swal-textarea" style="height: 300px;width:100%">${t}</textarea>`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",preConfirm:()=>{const t=this.$swal.getPopup().querySelector("#swal-textarea").value;return t||this.$swal.showValidationMessage("內容不可空白"),t.length>2e3&&this.$swal.showValidationMessage("內容不可超過2000個字符"),"book"==e?(this.bookMessage.description=t,t):(this.bookData.authorIntro=t,t)}}).then((e=>{}))},checkBookData(){let e=!0;return""===this.bookData.name?(this.errorHint.name="書名不可為空",e=!1):this.bookData.name.length>100?(this.errorHint.name="書名長度不可大於100個字符串",e=!1):this.errorHint.name="",""===this.bookMessage.type?(this.errorHint.type="請選擇主類型",e=!1):this.errorHint.type="",0===this.bookMessage.subTypes.length?(this.errorHint.subTypes="請至少選擇一項子類型",e=!1):this.errorHint.subTypes="",this.bookMessage.bookTag.length>15?(this.errorHint.bookTag="標籤數量不得超過15個",e=!1):this.errorHint.bookTag="",""===this.bookMessage.description?(this.errorHint.description="書籍介紹不可為空",e=!1):this.errorHint.description="",0===this.images.length?(this.errorHint.photo="請至少放上一張圖片",e=!1):this.errorHint.photo="",""===this.bookMessage.publicationDate?(this.errorHint.publicationDate="出版日期不可為空",e=!1):this.errorHint.publicationDate="",this.bookMessage.author.length>6?(this.errorHint.author="作者人數不得超過6個",e=!1):0===this.bookMessage.author.length?(this.errorHint.author="作者人數不得為0",e=!1):this.errorHint.author="",""===this.bookData.authorIntro&&(this.errorHint.authorIntro="作者介紹不可為空",e=!1),this.bookMessage.entity||this.bookMessage.ebook?this.errorHint.saleType="":this.errorHint.saleType="請至少選擇一種販售方式",this.bookMessage.entity&&0==this.bookMessage.entityPrice?(this.errorHint.entityPrice="價格不可為0",e=!1):this.errorHint.entityPrice="",this.bookMessage.ebook&&0==this.bookMessage.ebookPrice?(this.errorHint.ebookPrice="價格不可為0",e=!1):this.errorHint.ebookPrice="",e},addBook(){this.checkBookData()&&(1==this.bookMessage.ebook&&this.bookMessage.saleTag.push("電子書"),1==this.bookMessage.entity&&this.bookMessage.saleTag.push("實體書"),this.updateSerialNumber(),this.bookMessage.status="審核中",this.bookMessage.name=this.bookData.name,this.$swal.fire({title:"處理中...",text:"正在上傳資料，請稍候",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,showCancelButton:!1,didOpen:()=>{this.$swal.showLoading(),this.addToFirebase().then((()=>{this.$swal.close(),this.$swal.fire({title:"成功",text:"資料已成功上傳，請等待管理員審核",icon:"success",confirmButtonText:"確定",showCancelButton:!1})})).catch((e=>{this.$swal.close(),this.$swal.fire({title:"錯誤",text:"上傳過程中發生錯誤，請稍後重試",icon:"error",confirmButtonText:"確定"}),console.error("Error in addBook method:",e)}))}}))},updateSerialNumber(){const e=(new Date).toLocaleString("zh-TW",{timeZone:"Asia/Taipei",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});this.bookData.serialNumber=this.bookMessage.code+"_"+this.bookMessage.type+"_"+e.replace(/\D/g,"").slice(0,14),this.bookMessage.serialNumber=this.bookData.serialNumber,this.bookMessage.createTime=e,this.bookMessage.lastUpdateTime=e},async addToFirebase(){try{const e=await Promise.all(this.images.map((e=>this.convertFileToBase64(e)))),t=await this.convertFileToBase64(this.pdfFile),s=await i.A.post("/addBookRequest",{images:e,pdf:t,serialNumber:this.bookData.serialNumber,bookData:this.bookData,bookMessage:this.bookMessage,code:this.$store.state.userInfo.userInfoData.code,uid:JSON.parse(d.A.get("accountInfo")).uid});if(!s.data.success)return console.error("Error uploading files:",s.data.message),Promise.reject(s.data.message);console.log("Files uploaded successfully:")}catch(e){return console.error("Error in addBook method:",e),Promise.reject(e)}},convertFileToBase64(e){return new Promise(((t,s)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>t(o.result.split(",")[1]),o.onerror=e=>s(e)}))}},beforeMount(){this.nowPublisher=this.$store.state.userInfo.userInfoData,this.bookMessage.code=this.nowPublisher.code,this.bookMessage.publisherName=this.nowPublisher.name,this.getTypeList()}},b=p,h=s(1656),k=(0,h.A)(b,o,a,!1,null,"45d619f1",null),g=k.exports}}]);
//# sourceMappingURL=814.1e47e52c.js.map