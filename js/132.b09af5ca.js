"use strict";(self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[]).push([[132],{8132:function(i,t,e){e.r(t),e.d(t,{default:function(){return u}});var s=function(){var i=this,t=i._self._c;return t("div",{staticClass:"container mt-5"},[i.isVerifying?t("b-alert",{attrs:{variant:"warning"}},[i._v(" 驗證中... ")]):i._e(),i.user?t("b-card",[t("b-card-body",[i.user.emailVerified?[t("p",[i._v("歡迎, "+i._s(i.user.displayName))]),t("p",[i._v("電子信箱: "+i._s(i.user.email))]),i.user.photoURL?t("img",{staticClass:"img-thumbnail",attrs:{src:i.user.photoURL,alt:"用戶照片"}}):i._e(),t("b-button",{staticClass:"mt-3",attrs:{variant:"danger"},on:{click:i.logout}},[i._v("登出")])]:[i.user.emailVerified?i._e():t("p",{staticClass:"text-danger"},[i._v(" 請先驗證您的信箱 ")]),t("p",[i._v("電子信箱: "+i._s(i.user.email))]),i.user.emailVerified?i._e():t("b-button",{staticClass:"mt-3 ms-3",attrs:{variant:"warning",disabled:i.isCooldown},on:{click:i.resendVerificationEmail}},[i._v("重新發送驗證信")]),i.isCooldown&&!i.user.emailVerified?t("p",{staticClass:"text-warning mt-2"},[i._v(" 請等待 "+i._s(i.cooldownTime)+" 秒後再次發送驗證信。 ")]):i._e()]],2)],1):t("b-card",[t("b-card-body",[t("b-button",{attrs:{variant:"primary"},on:{click:i.loginWithGoogle}},[i._v(" 使用 Google 登入 ")])],1)],1),i.user?i._e():t("b-card",{staticClass:"mt-3"},[t("b-card-header",[i._v("註冊")]),t("b-card-body",[t("b-form",{on:{submit:function(t){return t.preventDefault(),i.register.apply(null,arguments)}}},[t("b-form-group",{attrs:{label:"Email"}},[t("b-form-input",{attrs:{type:"email",required:""},model:{value:i.email,callback:function(t){i.email=t},expression:"email"}})],1),t("b-form-group",{attrs:{label:"Password"}},[t("b-form-input",{attrs:{type:"password",required:""},model:{value:i.password,callback:function(t){i.password=t},expression:"password"}})],1),t("b-button",{staticClass:"mt-3",attrs:{type:"submit",variant:"success"}},[i._v("註冊")])],1)],1)],1),i.user?i._e():t("b-card",{staticClass:"mt-3"},[t("b-card-header",[i._v("登入")]),t("b-card-body",[t("b-form",{on:{submit:function(t){return t.preventDefault(),i.loginWithEmail.apply(null,arguments)}}},[t("b-form-group",{attrs:{label:"Email"}},[t("b-form-input",{attrs:{type:"email",required:""},model:{value:i.loginEmail,callback:function(t){i.loginEmail=t},expression:"loginEmail"}})],1),t("b-form-group",{attrs:{label:"Password"}},[t("b-form-input",{attrs:{type:"password",required:""},model:{value:i.loginPassword,callback:function(t){i.loginPassword=t},expression:"loginPassword"}})],1),t("b-button",{staticClass:"mt-3",attrs:{type:"submit",variant:"primary"}},[i._v("登入")])],1)],1)],1)],1)},a=[],r=e(9301),o={data(){return{user:null,email:"",password:"",loginEmail:"",loginPassword:"",phone:"",verificationCode:"",verificationId:null,isVerifying:!1,isCooldown:!1,cooldownTime:60}},methods:{async loginWithGoogle(){try{const i=await(0,r.G6)();this.user=i.user}catch(i){console.error("登录错误: ",i)}},async logout(){try{await(0,r.CI)(),this.user=null,sessionStorage.clear()}catch(i){console.error("登出错误: ",i)}},async register(){try{const i=await(0,r.bk)(this.email,this.password);this.user=i.user,console.log("驗證信已發送"),this.isVerifying=!0,this.startCooldown(),await this.checkEmailVerification()}catch(i){"auth/email-already-in-use"===i.code?alert("該信箱已經被註冊。請檢查您的信箱或嘗試登入。"):console.error("註冊錯誤: ",i),this.isVerifying=!1}},async loginWithEmail(){try{const i=await(0,r.Ru)(this.loginEmail,this.loginPassword);this.user=i.user,this.user.emailVerified||(this.isVerifying=!0,alert("請先驗證您的信箱。"),await this.checkEmailVerification())}catch(i){console.error("登入錯誤: ",i)}},async checkEmailVerification(){this.isVerifying=!0;let i=r.j2.currentUser;console.log("進行信箱驗證中....");while(i&&!i.emailVerified)await i.reload(),i=r.j2.currentUser,await new Promise((i=>setTimeout(i,2e3)));i&&i.emailVerified&&(this.isVerifying=!1,this.user=i,console.log("信箱以驗證"),this.test())},async resendVerificationEmail(){try{this.startCooldown(),await(0,r.nA)(),alert("驗證信已重新發送，請檢察您的信箱。")}catch(i){console.error("重新發送驗證信錯誤: ",i)}},startCooldown(){this.isCooldown=!0,this.cooldownTime=60;const i=setInterval((()=>{this.cooldownTime--,this.cooldownTime<=0&&(clearInterval(i),this.isCooldown=!1)}),1e3)},async test(){try{let i={email:this.user.email};await(0,r.VF)(this.user.uid,i)}catch(i){console.error(i)}}},created(){}},l=o,n=e(1656),c=(0,n.A)(l,s,a,!1,null,null,null),u=c.exports}}]);
//# sourceMappingURL=132.b09af5ca.js.map