"use strict";(self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[]).push([[761],{5761:function(t,e,a){a.r(e),a.d(e,{default:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container-fluid layout w-100 p-5"},[e("div",{staticClass:"d-flex"},[e("div",{staticClass:"ms-4"},[e("div",[e("button",{staticClass:"button_design",class:{selected:"審核中"===t.showStatus},on:{click:function(e){t.showStatus="審核中"}}},[t._v(" 審核中 ")])])]),e("div",{staticClass:"ms-4"},[e("div",[e("button",{staticClass:"button_design",class:{selected:"待修改"===t.showStatus},on:{click:function(e){t.showStatus="待修改"}}},[t._v(" 等待修改 ")])])])]),e("div",{staticClass:"content"},[e("el-table",{staticStyle:{width:"100%","background-color":"transparent"},attrs:{data:t.showData}},[t.dataOutlineLoaded?e("template",{slot:"empty"},[t._v("暫無數據")]):e("template",{slot:"empty"},[t._v("資料載入中...")]),e("el-table-column",{attrs:{prop:"createTime",label:"建單時間",sortable:"",width:"190"}}),e("el-table-column",{attrs:{prop:"serialNumber",label:"流水號",width:"220"}}),e("el-table-column",{attrs:{prop:"name",label:"書籍名稱"}}),e("el-table-column",{attrs:{prop:"option",label:"最後更新時間",width:"190"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.lastUpdateTime))])]}}])}),e("el-table-column",{attrs:{prop:"option",label:"請求類別",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return["addBook"===a.row.option?e("span",[t._v("新增商品")]):"editBook"===a.row.option?e("span",[t._v("修改商品資訊")]):e("span",[t._v("未知類別")])]}}])}),e("el-table-column",{attrs:{width:"180"},scopedSlots:t._u([{key:"header",fn:function(t){return[e("el-input",{attrs:{size:"mini",placeholder:"輸入關鍵字搜尋"}})]}},{key:"default",fn:function(a){return[e("div",{staticClass:"d-flex justify-content-around align-items-center"},[e("div",[e("button",{staticClass:"button_design p-1",attrs:{"data-bs-toggle":"modal","data-bs-target":"#detailDataModal"},on:{click:function(e){return t.showBookDetail(a.$index,a.row)}}},[t._v(" "+t._s("待修改"!==t.showStatus?"審核內容":"查看內容")+" ")])])])]}}])})],2)],1),e("div",{staticClass:"d-flex justify-content-end mt-2"},[e("el-pagination",{attrs:{layout:"prev, pager, next",total:t.tableData.length,"page-size":t.pageNumber,"current-page":t.nowPage},on:{"current-change":t.handlePageChange}})],1),e("div",{staticClass:"modal fade",attrs:{id:"detailDataModal",tabindex:"-1","aria-labelledby":"detailDataModalLabel","aria-hidden":"true","data-bs-backdrop":"static","data-bs-focus":"false"}},[e("div",{staticClass:"modal-dialog modal-lg"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header justify-content-between"},[e("div",[e("h2",{staticClass:"modal-title fs-6",attrs:{id:"detailDataModalLabel"}},[t._v(" "+t._s(t.selectedBookDataOutline.serialNumber)+" ")]),e("div",[e("button",{staticClass:"button_design m-1 p-0 fs-6",class:{selected:"書籍"===t.showDetailType,disabled:"書籍"===t.showDetailType},attrs:{type:"button",disabled:"書籍"===t.showDetailType},on:{click:function(e){t.showDetailType="書籍",t.transitionName="slide-right"}}},[t._v(" 書籍 ")]),e("button",{staticClass:"button_design m-1 p-0 fs-6",class:{selected:"出版"===t.showDetailType,disabled:"出版"===t.showDetailType},attrs:{type:"button"},on:{click:function(e){t.showDetailType="出版",t.transitionName="slide-left"}}},[t._v(" 出版/販售 ")])])]),e("div",[e("button",{staticClass:"close_btn",attrs:{type:"button"},on:{click:function(e){return t.closeModal()}}},[e("i",{staticClass:"bi bi-plus-lg"})])])]),t.dataDetailLoaded?e("div",{staticClass:"modal-body d-flex"},[e("div",{staticClass:"d-flex align-items-center justify-content-center",staticStyle:{width:"5%"}},[e("div",{staticClass:"arrow-btn",class:{disabled:"書籍"===t.showDetailType},on:{click:function(e){t.showDetailType="書籍",t.transitionName="slide-right"}}},[e("i",{staticClass:"bi bi-caret-left-fill"})])]),e("transition-group",{staticStyle:{width:"90%"},attrs:{name:t.transitionName,tag:"div"}},["書籍"===t.showDetailType?e("div",{key:"1",staticStyle:{"overflow-x":"auto"}},[e("table",{staticClass:"table"},[e("tr",[e("th",[t._v("書籍名稱")]),e("td",[t._v(" "+t._s(t.selectedBookDataOutline.name)+" ")])]),e("tr",[e("th",[t._v("語言分類")]),e("td",[t.selectedBookDataOutline.isForeign?[t._v("中文")]:[t._v("外文")]],2)]),e("tr",[e("th",[t._v("主類型")]),e("td",[t._v(" "+t._s(t.typeList[t.selectedBookDataOutline.type].name)+" ")])]),e("tr",[e("th",[t._v("子類型")]),e("td",[t._l(t.selectedBookDataOutline.subTypes,(function(e,a){return[t._v(" "+t._s(e)+" "),a!=t.selectedBookDataOutline.subTypes.length-1?[t._v(" , ")]:t._e()]}))],2)]),e("tr",[e("th",[t._v("書籍標籤")]),e("td",[t._l(t.selectedBookDataOutline.bookTag,(function(e,a){return[t._v(" "+t._s(e)+" "),a!=t.selectedBookDataOutline.bookTag.length-1?[t._v(" , ")]:t._e()]}))],2)]),e("tr",[e("th",[t._v("書籍介紹")]),e("td",{staticClass:"p-1"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.selectedBookDataOutline.description,expression:"\n                                                selectedBookDataOutline.description\n                                            "}],attrs:{readonly:""},domProps:{value:t.selectedBookDataOutline.description},on:{input:function(e){e.target.composing||t.$set(t.selectedBookDataOutline,"description",e.target.value)}}})])]),e("tr",[e("th",[t._v("圖片")]),e("td",{staticClass:"p-1"},[e("table",{staticClass:"w-100",staticStyle:{"background-color":"transparent"}},[e("tr",[e("td",{staticStyle:{border:"none",color:"red"}},[t._v(" 圖一為商品封面 ")])]),t._l(t.rows,(function(a,s){return e("tr",{key:s,staticStyle:{border:"none"}},t._l(a,(function(a,i){return e("td",{key:i,staticClass:"p-1",staticStyle:{border:"none"}},[e("img",{attrs:{src:a,alt:"content page photo"}}),e("div",[t._v(" 圖"+t._s(4*s+i+1)+" ")])])})),0)}))],2)])])])]):t._e(),"出版"===t.showDetailType?e("div",{key:"2",staticStyle:{"overflow-x":"auto"}},[e("table",{staticClass:"table"},[e("tr",[e("th",[t._v("出版社代號")]),e("td",{attrs:{colspan:"5"}},[t._v(" "+t._s(t.selectedBookDataOutline.code)+" ")])]),e("tr",[e("th",[t._v("出版社名稱")]),e("td",{attrs:{colspan:"5"}},[t._v(" "+t._s(t.selectedBookDataOutline.publisherName)+" ")])]),e("tr",[e("th",[t._v("出版日期")]),e("td",{attrs:{colspan:"5"}},[t._v(" "+t._s(t.selectedBookDataOutline.publicationDate)+" ")])]),e("tr",[e("th",[t._v("作者")]),e("td",{attrs:{colspan:"5"}},[t._l(t.selectedBookDataOutline.author,(function(e,a){return[t._v(" "+t._s(e)+" "),a!=t.selectedBookDataOutline.author.length-1?[t._v(" , ")]:t._e()]}))],2)]),e("tr",[e("th",[t._v("作者介紹")]),e("td",{staticClass:"p-1",attrs:{colspan:"5"}},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bookDataDetail.authorIntro,expression:"\n                                                bookDataDetail.authorIntro\n                                            "}],attrs:{readonly:""},domProps:{value:t.bookDataDetail.authorIntro},on:{input:function(e){e.target.composing||t.$set(t.bookDataDetail,"authorIntro",e.target.value)}}})])]),e("tr",[e("th",[t._v("實體書販售")]),t.selectedBookDataOutline.entity?[e("td",[t._v("有")]),e("td",{staticClass:"title"},[t._v("價格")]),e("td",[t._v(" NT$ "+t._s(t.selectedBookDataOutline.entityPrice)+" ")]),e("td",{staticClass:"title"},[t._v("庫存")]),e("td",[t._v(" "+t._s(t.selectedBookDataOutline.stock)+" 本 ")])]:[e("td",[t._v("無")]),e("td",{staticClass:"title"},[t._v("價格")]),e("td"),e("td",{staticClass:"title"},[t._v("庫存")]),e("td")]],2),e("tr",[e("th",[t._v("電子書販售")]),t.selectedBookDataOutline.ebook?[e("td",[t._v("有")]),e("td",{staticClass:"title"},[t._v("價格")]),e("td",{attrs:{colspan:"3"}},[t._v(" NT$ "+t._s(t.selectedBookDataOutline.ebookPrice)+" ")])]:[e("td",[t._v("無")]),e("td",{staticClass:"title"},[t._v("價格")]),e("td",{attrs:{colspan:"3"}})]],2),e("tr",[e("th",[t._v("最後請求修改訊息")]),e("td",{staticClass:"p-1",attrs:{colspan:"5"}},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.selectedBookDataOutline.fixMessage,expression:"\n                                                selectedBookDataOutline.fixMessage\n                                            "}],attrs:{readonly:""},domProps:{value:t.selectedBookDataOutline.fixMessage},on:{input:function(e){e.target.composing||t.$set(t.selectedBookDataOutline,"fixMessage",e.target.value)}}})])])])]):t._e()]),e("div",{staticClass:"d-flex align-items-center justify-content-center",staticStyle:{width:"5%"}},[e("div",{staticClass:"arrow-btn",class:{disabled:"出版"===t.showDetailType},on:{click:function(e){t.showDetailType="出版",t.transitionName="slide-left"}}},[e("i",{staticClass:"bi bi-caret-right-fill"})])])],1):e("div",{staticClass:"modal-body",staticStyle:{height:"auto"}},[t._m(0)]),t.dataDetailLoaded?e("div",{staticClass:"modal-footer d-flex justify-content-between"},[e("div",[e("button",{staticClass:"button_design p-1",on:{click:function(e){return t.closeModal()}}},[t._v(" 返回 ")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:"出版"===t.showDetailType&&"審核中"==t.showStatus,expression:"\n                            showDetailType === '出版' &&\n                            showStatus == '審核中'\n                        "}]},[e("button",{staticClass:"button_design p-1",on:{click:function(e){return t.confirmQualified()}}},[t._v(" 合格/上架 ")]),e("button",{staticClass:"button_design p-1 ms-2",on:{click:function(e){return t.fixRequestData()}}},[t._v(" 不合格/修正 ")])])]):t._e()])])])])},i=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"loading-overlay"},[e("div",{staticClass:"loading-spinner-container"},[e("div",{staticClass:"loading-spinner"})]),e("div",{staticClass:"loading-text"},[t._v("資料載入中...")])])}],o=(a(4114),a(9470)),n=(a(8704),a(8077)),l={data(){return{showStatus:"審核中",nowPage:1,pageNumber:5,requestListData:[],typeList:{},bookDataDetail:{},dataDetailLoaded:!1,dataOutlineLoaded:!1,showDetailType:"書籍",transitionName:"slide-right",selectedBookDataOutline:{}}},computed:{rows(){const t=4,e=[];for(let a=0;a<this.selectedBookDataOutline.contentPagePhoto.length;a+=t)e.push(this.selectedBookDataOutline.contentPagePhoto.slice(a,a+t));return e},tableData(){return this.requestListData.filter((t=>t.status===this.showStatus))},showData(){const t=(this.nowPage-1)*this.pageNumber,e=t+this.pageNumber;return this.tableData.slice(t,e)}},methods:{async getRequestListData(){try{const t=await o.A.post("/getAllRequestList",{});t.data.success?this.requestListData=t.data.data:console.error("Failed to getDataList:",t.data.message)}catch(t){console.error("Error Code:",t)}},handlePageChange(t){this.nowPage=t,this.getShowData()},async showBookDetail(t,e){try{const t=await o.A.post("/getBookDataDetailAdmin",{serialNumber:e.serialNumber});t.data.success?(this.bookDataDetail=t.data.data,this.dataDetailLoaded=!0,this.selectedBookDataOutline=e):console.error("Failed to getDataDetail:",t.data.message)}catch(a){console.error("Error Data SerialNumber:",a)}},getTypeList(){this.typeList=this.$store.state.generalInfo.typeList},closeModal(){this.dataDetailLoaded=!1,this.bookDataDetail={},this.selectedBookDataOutline={};var t=document.getElementById("detailDataModal"),e=n.aF.getInstance(t);e.hide()},async getInit(){await this.getRequestListData(),this.getTypeList(),this.dataOutlineLoaded=!0},confirmQualified(){this.$swal.fire({title:"確認合格",text:`您確定該序列號為 ${this.selectedBookDataOutline.serialNumber} 的資料合格嗎?`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",reverseButtons:!0}).then((t=>{t.isConfirmed&&this.$swal.fire({title:"處理中...",text:"正在更新狀態，請稍候",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,cancelButtonText:"取消",didOpen:()=>{this.$swal.showLoading(),this.qualifiedDataToFireBase().then((()=>{this.$swal.close(),this.$swal.fire({title:"成功",text:"資料已成功更新",icon:"success",confirmButtonText:"確定",showCancelButton:!1}).then((t=>{if(t.isConfirmed){const t=this.requestListData.findIndex((t=>t.serialNumber===this.selectedBookDataOutline.serialNumber));-1!==t&&this.requestListData.splice(t,1),this.closeModal()}}))})).catch((t=>{this.$swal.close(),this.$swal.fire({title:"錯誤",text:"更新過程中發生錯誤，請稍後重試",icon:"error",confirmButtonText:"確定"}),console.error("Error in update method:",t)}))}})}))},async qualifiedDataToFireBase(){try{const t=await o.A.post("/dataCertified",{serialNumber:this.selectedBookDataOutline.serialNumber});if(!t.data.success)return Promise.reject(t.data.message);{const t=this.requestListData.findIndex((t=>t.serialNumber===this.selectedBookDataOutline.serialNumber));-1!==t&&this.requestListData.splice(t,1)}}catch(t){return console.error("Error in method:",t),Promise.reject(t)}},fixRequestData(){this.$swal.fire({title:"請輸入修改事項",html:'<textarea id="swal-textarea" style="height: 300px;width:100%;z-index: 2000;"></textarea>',focusConfirm:!1,showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",preConfirm:()=>{const t=this.$swal.getPopup().querySelector("#swal-textarea").value;if(t){if(!(t.length>2e3))return this.selectedBookDataOutline.fixMessage=t,t;this.$swal.showValidationMessage("內容不可超過2000個字符")}else this.$swal.showValidationMessage("內容不可空白")},didOpen:()=>{document.querySelector("#swal-textarea").focus()}}).then((t=>{t.isConfirmed&&this.$swal.fire({title:"處理中...",text:"正在更新狀態，請稍候",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,cancelButtonText:"取消",didOpen:()=>{this.$swal.showLoading(),this.fixMessageToFireBase().then((()=>{this.$swal.close(),this.$swal.fire({title:"成功",text:"資料已成功更新",icon:"success",confirmButtonText:"確定",showCancelButton:!1}).then((t=>{if(t.isConfirmed){const t=this.requestListData.findIndex((t=>t.serialNumber===this.selectedBookDataOutline.serialNumber));this.requestListData[t].status="待修改",this.closeModal()}}))})).catch((t=>{this.$swal.close(),this.$swal.fire({title:"錯誤",text:"更新過程中發生錯誤，請稍後重試",icon:"error",confirmButtonText:"確定"}),console.error("Error in update method:",t)}))}})}))},async fixMessageToFireBase(){try{const t=await o.A.post("/dataNotCertified",{serialNumber:this.selectedBookDataOutline.serialNumber,fixMessage:this.selectedBookDataOutline.fixMessage});if(!t.data.success)return Promise.reject(t.data.message);{const t=this.requestListData.findIndex((t=>t.serialNumber===this.selectedBookDataOutline.serialNumber));-1!==t&&(this.requestListData[t].fixMessage=this.selectedBookDataOutline.fixMessage,this.requestListData[t].status="待修改")}}catch(t){return console.error("Error in method:",t),Promise.reject(t)}}},beforeMount(){this.getInit()},mounted(){}},r=l,c=a(1656),d=(0,c.A)(r,s,i,!1,null,"c755bb1a",null),u=d.exports},8704:function(t,e,a){
/*! js-cookie v3.0.5 | MIT */
function s(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var s in a)t[s]=a[s]}return t}a.d(e,{A:function(){return n}});var i={read:function(t){return'"'===t[0]&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function o(t,e){function a(a,i,o){if("undefined"!==typeof document){o=s({},e,o),"number"===typeof o.expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),a=encodeURIComponent(a).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var n="";for(var l in o)o[l]&&(n+="; "+l,!0!==o[l]&&(n+="="+o[l].split(";")[0]));return document.cookie=a+"="+t.write(i,a)+n}}function i(e){if("undefined"!==typeof document&&(!arguments.length||e)){for(var a=document.cookie?document.cookie.split("; "):[],s={},i=0;i<a.length;i++){var o=a[i].split("="),n=o.slice(1).join("=");try{var l=decodeURIComponent(o[0]);if(s[l]=t.read(n,l),e===l)break}catch(r){}}return e?s[e]:s}}return Object.create({set:a,get:i,remove:function(t,e){a(t,"",s({},e,{expires:-1}))},withAttributes:function(t){return o(this.converter,s({},this.attributes,t))},withConverter:function(t){return o(s({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var n=o(i,{path:"/"})}}]);
//# sourceMappingURL=761.71bfad64.js.map