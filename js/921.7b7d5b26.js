"use strict";(self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[]).push([[921],{6436:function(t,e,s){s.r(e),s.d(e,{default:function(){return w}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container-fluid layout w-100 p-5"},[e("div",{staticClass:"d-flex"},[e("div",{staticClass:"ms-4"},[t.reviewReads>0?e("div",[e("el-badge",{staticClass:"item",attrs:{value:t.reviewReads}},[e("button",{staticClass:"button_design",class:{selected:"審核中"===t.showStatus},on:{click:function(e){t.showStatus="審核中"}}},[t._v(" 審核中 ")])])],1):e("div",[e("button",{staticClass:"button_design",class:{selected:"審核中"===t.showStatus},on:{click:function(e){t.showStatus="審核中"}}},[t._v(" 審核中 ")])])]),e("div",{staticClass:"ms-4"},[t.revisionReads>0?e("div",[e("el-badge",{staticClass:"item",attrs:{value:t.revisionReads}},[e("button",{staticClass:"button_design",class:{selected:"待修改"===t.showStatus},on:{click:function(e){t.showStatus="待修改"}}},[t._v(" 待修改 ")])])],1):e("div",[e("button",{staticClass:"button_design",class:{selected:"待修改"===t.showStatus},on:{click:function(e){t.showStatus="待修改"}}},[t._v(" 待修改 ")])])]),e("div",{staticClass:"ms-4"},[t.completeReads>0?e("div",[e("el-badge",{staticClass:"item",attrs:{value:t.completeReads}},[e("button",{staticClass:"button_design",class:{selected:"已完成"===t.showStatus},on:{click:function(e){t.showStatus="已完成"}}},[t._v(" 已完成 ")])])],1):e("div",[e("button",{staticClass:"button_design",class:{selected:"已完成"===t.showStatus},on:{click:function(e){t.showStatus="已完成"}}},[t._v(" 已完成 ")])])])]),e("div",{staticClass:"content"},[e("el-table",{staticStyle:{width:"100%","background-color":"transparent"},attrs:{data:t.showData}},[t.dataOutlineLoaded?e("template",{slot:"empty"},[t._v("暫無數據")]):e("template",{slot:"empty"},[t._v("資料載入中...")]),e("el-table-column",{attrs:{prop:"createTime",label:"建單時間",sortable:"",width:"190"}}),e("el-table-column",{attrs:{prop:"serialNumber",label:"流水號",width:"220"}}),e("el-table-column",{attrs:{prop:"name",label:"書籍名稱"}}),e("el-table-column",{attrs:{prop:"option",label:"請求類別",width:"100"},scopedSlots:t._u([{key:"default",fn:function(s){return["addBook"===s.row.option?e("span",[t._v("新增商品")]):"editBook"===s.row.option?e("span",[t._v("修改商品資訊")]):e("span",[t._v("未知類別")])]}}])}),e("el-table-column",{attrs:{width:"180"},scopedSlots:t._u([{key:"header",fn:function(t){return[e("el-input",{attrs:{size:"mini",placeholder:"輸入關鍵字搜尋"}})]}},{key:"default",fn:function(s){return[e("div",{staticClass:"d-flex justify-content-around align-items-center"},[s.row.read?e("div",["審核中"===t.showStatus||"已完成"===t.showStatus?e("button",{staticClass:"button_design p-1",attrs:{"data-bs-toggle":"modal","data-bs-target":"#detailDataModal"},on:{click:function(e){return t.showBookDetail(s.$index,s.row)}}},[t._v(" 查看內容 ")]):"待修改"===t.showStatus?e("button",{staticClass:"button_design p-1",attrs:{"data-bs-toggle":"modal","data-bs-target":"#detailDataFixModal"},on:{click:function(e){return t.fixBookDetail(s.$index,s.row)}}},[t._v(" 修改內容 ")]):t._e()]):e("div",{staticClass:"p-1"},[e("el-badge",{staticClass:"item",attrs:{"is-dot":""}},["審核中"===t.showStatus||"已完成"===t.showStatus?e("button",{staticClass:"button_design p-1",attrs:{"data-bs-toggle":"modal","data-bs-target":"#detailDataModal"},on:{click:function(e){return t.showBookDetail(s.$index,s.row)}}},[t._v(" 查看內容 ")]):"待修改"===t.showStatus?e("button",{staticClass:"button_design p-1",attrs:{"data-bs-toggle":"modal","data-bs-target":"#detailDataFixModal"},on:{click:function(e){return t.fixBookDetail(s.$index,s.row)}}},[t._v(" 修改內容 ")]):t._e()])],1),"已完成"!=t.showStatus?e("div",{staticClass:"p-1"},[e("button",{staticClass:"button_design p-1",on:{click:function(e){return t.deleteAddBook(s.$index,s.row)}}},[e("i",{staticClass:"bi bi-trash"})])]):t._e()])]}}])})],2)],1),e("div",{staticClass:"d-flex justify-content-end mt-2"},[e("el-pagination",{attrs:{layout:"prev, pager, next",total:t.tableData.length,"page-size":t.pageNumber,"current-page":t.nowPage},on:{"current-change":t.handlePageChange}})],1),"審核中"==t.showStatus||"已完成"==t.showStatus?e("div",{staticClass:"modal fade",attrs:{id:"detailDataModal",tabindex:"-1","aria-labelledby":"detailDataModalLabel","aria-hidden":"true","data-bs-backdrop":"static"}},[e("div",{staticClass:"modal-dialog modal-lg"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header justify-content-between"},[e("div",[e("h2",{staticClass:"modal-title fs-6",attrs:{id:"detailDataModalLabel"}},[t._v(" "+t._s(t.selectedBookDataOutline.serialNumber)+" ")]),e("div",[e("button",{staticClass:"button_design m-1 p-0 fs-6",class:{selected:"書籍"===t.showDetailType},attrs:{type:"button"},on:{click:function(e){t.showDetailType="書籍"}}},[t._v(" 書籍 ")]),e("button",{staticClass:"button_design m-1 p-0 fs-6",class:{selected:"出版"===t.showDetailType},attrs:{type:"button"},on:{click:function(e){t.showDetailType="出版"}}},[t._v(" 出版/販售 ")])])]),e("div",[e("button",{staticClass:"close_btn",attrs:{type:"button"},on:{click:function(e){return t.closeModal("detailDataModal")}}},[e("i",{staticClass:"bi bi-plus-lg"})])])]),t.dataDetailLoaded&&"書籍"===t.showDetailType?e("div",{staticClass:"modal-body"},[e("div",{staticStyle:{"overflow-x":"auto"}},[e("table",{staticClass:"table"},[e("tr",[e("th",[t._v("書籍名稱")]),e("td",[t._v(t._s(t.selectedBookDataOutline.name))])]),e("tr",[e("th",[t._v("語言分類")]),e("td",[t.selectedBookDataOutline.isForeign?[t._v("中文")]:[t._v("外文")]],2)]),e("tr",[e("th",[t._v("主類型")]),e("td",[t._v(" "+t._s(t.typeList[t.selectedBookDataOutline.type].name)+" ")])]),e("tr",[e("th",[t._v("子類型")]),e("td",[t._l(t.selectedBookDataOutline.subTypes,(function(e,s){return[t._v(" "+t._s(e)+" "),s!=t.selectedBookDataOutline.subTypes.length-1?[t._v(" , ")]:t._e()]}))],2)]),e("tr",[e("th",[t._v("書籍標籤")]),e("td",[t._l(t.selectedBookDataOutline.bookTag,(function(e,s){return[t._v(" "+t._s(e)+" "),s!=t.selectedBookDataOutline.bookTag.length-1?[t._v(" , ")]:t._e()]}))],2)]),e("tr",[e("th",[t._v("書籍介紹")]),e("td",{staticClass:"p-1"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.selectedBookDataOutline.description,expression:"\n                                            selectedBookDataOutline.description\n                                        "}],attrs:{readonly:""},domProps:{value:t.selectedBookDataOutline.description},on:{input:function(e){e.target.composing||t.$set(t.selectedBookDataOutline,"description",e.target.value)}}})])]),e("tr",[e("th",[t._v("圖片")]),e("td",{staticClass:"p-1"},[e("table",{staticClass:"w-100",staticStyle:{"background-color":"transparent"}},[t._m(0),t._l(t.rows,(function(s,a){return e("tr",{key:a,staticStyle:{border:"none"}},t._l(s,(function(s,o){return e("td",{key:o,staticClass:"p-1",staticStyle:{border:"none"}},[e("img",{attrs:{src:s,alt:"content page photo"}}),e("div",[t._v(" 圖"+t._s(4*a+o+1)+" ")])])})),0)}))],2)])])])])]):t.dataDetailLoaded&&"出版"===t.showDetailType?e("div",{staticClass:"modal-body"},[e("div",{staticStyle:{"overflow-x":"auto"}},[e("table",{staticClass:"table"},[e("tr",[e("th",[t._v("出版社代號")]),e("td",{attrs:{colspan:"5"}},[t._v(" "+t._s(t.selectedBookDataOutline.code)+" ")])]),e("tr",[e("th",[t._v("出版日期")]),e("td",{attrs:{colspan:"5"}},[t._v(" "+t._s(t.selectedBookDataOutline.publicationDate)+" ")])]),e("tr",[e("th",[t._v("作者")]),e("td",{attrs:{colspan:"5"}},[t._l(t.selectedBookDataOutline.author,(function(e,s){return[t._v(" "+t._s(e)+" "),s!=t.selectedBookDataOutline.author.length-1?[t._v(" , ")]:t._e()]}))],2)]),e("tr",[e("th",[t._v("作者介紹")]),e("td",{staticClass:"p-1",attrs:{colspan:"5"}},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bookDataDetail.authorIntro,expression:"bookDataDetail.authorIntro"}],attrs:{readonly:""},domProps:{value:t.bookDataDetail.authorIntro},on:{input:function(e){e.target.composing||t.$set(t.bookDataDetail,"authorIntro",e.target.value)}}})])]),e("tr",[e("th",[t._v("實體書販售")]),t.selectedBookDataOutline.entity?[e("td",[t._v("有")]),e("td",{staticClass:"title"},[t._v("價格")]),e("td",[t._v(" NT$ "+t._s(t.selectedBookDataOutline.entityPrice)+" ")]),e("td",{staticClass:"title"},[t._v("庫存")]),e("td",[t._v(" "+t._s(t.selectedBookDataOutline.stock)+" 本 ")])]:[e("td",[t._v("無")]),e("td",{staticClass:"title"},[t._v("價格")]),e("td"),e("td",{staticClass:"title"},[t._v("庫存")]),e("td")]],2),e("tr",[e("th",[t._v("電子書販售")]),t.selectedBookDataOutline.ebook?[e("td",[t._v("有")]),e("td",{staticClass:"title"},[t._v("價格")]),e("td",{attrs:{colspan:"3"}},[t._v(" NT$ "+t._s(t.selectedBookDataOutline.ebookPrice)+" ")])]:[e("td",[t._v("無")]),e("td",{staticClass:"title"},[t._v("價格")]),e("td",{attrs:{colspan:"3"}})]],2)])])]):e("div",{staticClass:"modal-body",staticStyle:{height:"auto"}},[t._m(1)])])])]):t._e(),"待修改"==t.showStatus?e("div",{staticClass:"modal fade",attrs:{id:"detailDataFixModal",tabindex:"-1","aria-labelledby":"detailDataFixModalLabel","aria-hidden":"true","data-bs-focus":"false","data-bs-backdrop":"static"}},[e("div",{staticClass:"modal-dialog modal-xl"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header justify-content-between"},[e("div",[e("h2",{staticClass:"modal-title fs-6",attrs:{id:"detailDataFixModalLabel"}},[t._v(" 修改:"+t._s(t.selectedBookDataOutline.serialNumber)+" ")])]),e("div",[e("button",{staticClass:"close_btn",attrs:{type:"button"},on:{click:function(e){return t.closeModal("detailDataFixModal")}}},[e("i",{staticClass:"bi bi-plus-lg"})])])]),t.dataDetailLoaded?e("div",{staticClass:"modal-body"},[e("FixBook",{attrs:{bookDataFromView:t.bookDataDetail,bookMessageFromView:t.selectedBookDataOutline},on:{closeModal:function(e){return t.closeModal("detailDataFixModal")}}})],1):e("div",{staticClass:"modal-body",staticStyle:{height:"auto"}},[t._m(2)])])])]):t._e()])},o=[function(){var t=this,e=t._self._c;return e("tr",[e("td",{staticStyle:{border:"none",color:"red"}},[t._v(" 圖一為商品封面 ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"loading-overlay"},[e("div",{staticClass:"loading-spinner-container"},[e("div",{staticClass:"loading-spinner"})]),e("div",{staticClass:"loading-text"},[t._v("資料載入中...")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"loading-overlay"},[e("div",{staticClass:"loading-spinner-container"},[e("div",{staticClass:"loading-spinner"})]),e("div",{staticClass:"loading-text"},[t._v("資料載入中...")])])}],i=(s(4114),s(9470)),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container-fluid layout w-100"},[e("article",{staticClass:"l-design-width"},[e("div",{staticClass:"card row flex-row"},[e("div",{staticClass:"col-lg-12 col-12 p-1 d-flex flex-row-reverse"},[e("div",{staticClass:"input w-100"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.fixMessage,expression:"bookMessage.fixMessage"}],staticClass:"input__field",staticStyle:{color:"red",height:"150px"},attrs:{placeholder:"",readonly:""},domProps:{value:t.bookMessage.fixMessage},on:{input:function(e){e.target.composing||t.$set(t.bookMessage,"fixMessage",e.target.value)}}}),e("span",{staticClass:"input__label"},[t._v("審核未通過原因")])])]),e("div",{staticClass:"col-lg-6 col-12 p-2"},[e("div",{staticClass:"d-flex justify-content-between"},[e("h3",[t._v("書籍資料")]),e("button",{on:{click:function(e){return t.checkBookData()}}},[t._v("檢查")])]),e("div",{staticClass:"d-flex justify-content-end"},[e("small",{staticClass:"errorhint",staticStyle:{color:"green"}},[t._v(t._s(t.qualified))])]),e("div",{staticClass:"input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.name,expression:"bookMessage.name"}],staticClass:"input__field",attrs:{type:"text",placeholder:""},domProps:{value:t.bookMessage.name},on:{input:function(e){e.target.composing||t.$set(t.bookMessage,"name",e.target.value)}}}),e("span",{staticClass:"input__label"},[t._v("書籍名稱")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.name))])]),e("div",{staticClass:"input"},[e("div",{staticClass:"input__field h-100 d-flex flex-wrap"},[e("div",{staticClass:"form-check col-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.isForiegn,expression:"bookMessage.isForiegn"}],staticClass:"form-check-input",attrs:{type:"radio",name:"languageRadio",id:"isForiegnRadio_false"},domProps:{value:!1,checked:t._q(t.bookMessage.isForiegn,!1)},on:{change:function(e){return t.$set(t.bookMessage,"isForiegn",!1)}}}),e("label",{staticClass:"form-check-label",attrs:{for:"isForiegnRadio_false"}},[t._v(" 中文 ")])]),e("div",{staticClass:"form-check col-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.isForiegn,expression:"bookMessage.isForiegn"}],staticClass:"form-check-input",attrs:{type:"radio",name:"languageRadio",id:"isForiegnRadio_true"},domProps:{value:!0,checked:t._q(t.bookMessage.isForiegn,!0)},on:{change:function(e){return t.$set(t.bookMessage,"isForiegn",!0)}}}),e("label",{staticClass:"form-check-label",attrs:{for:"isForiegnRadio_true"}},[t._v(" 外文 ")])])]),e("span",{staticClass:"input__label"},[t._v("語言分類")])]),e("div",{staticClass:"input"},[e("div",{staticClass:"input__field d-flex flex-wrap"},t._l(Object.keys(t.typeList),(function(s,a){return e("div",{key:s,staticClass:"form-check col-12 col-sm-12 col-md-6 col-lg-3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.type,expression:"bookMessage.type"}],staticClass:"form-check-input",attrs:{type:"radio",name:"typeRadio",id:"typeRadio_"+a},domProps:{value:s,checked:t._q(t.bookMessage.type,s)},on:{change:[function(e){return t.$set(t.bookMessage,"type",s)},function(e){return t.changeTypeRadio(s)}]}}),e("label",{staticClass:"form-check-label",attrs:{for:"typeRadio_"+a}},[t._v(" "+t._s(t.typeList[s].name)+" ")])])})),0),e("span",{staticClass:"input__label"},[t._v("主類型")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.type))])]),e("div",{staticClass:"input"},[e("div",{staticClass:"input__field d-flex flex-wrap"},t._l(t.nowSubTypesInfo,(function(s,a){return e("div",{staticClass:"form-check col-12 col-sm-12 col-md-6 col-lg-3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.subTypes,expression:"bookMessage.subTypes"}],staticClass:"form-check-input",attrs:{type:"checkbox",name:"subTypeCheckBox",id:"subTypeCheckBox_"+a},domProps:{value:s,checked:Array.isArray(t.bookMessage.subTypes)?t._i(t.bookMessage.subTypes,s)>-1:t.bookMessage.subTypes},on:{change:function(e){var a=t.bookMessage.subTypes,o=e.target,i=!!o.checked;if(Array.isArray(a)){var l=s,n=t._i(a,l);o.checked?n<0&&t.$set(t.bookMessage,"subTypes",a.concat([l])):n>-1&&t.$set(t.bookMessage,"subTypes",a.slice(0,n).concat(a.slice(n+1)))}else t.$set(t.bookMessage,"subTypes",i)}}}),e("label",{staticClass:"form-check-label",attrs:{for:"subTypeCheckBox_"+a}},[t._v(" "+t._s(s)+" ")])])})),0),e("span",{staticClass:"input__label"},[t._v("子類型")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.subTypes))])]),e("div",{staticClass:"input"},[e("div",{staticClass:"input__field d-flex flex-wrap"},[e("TagInput",{on:{input:function(t){}},model:{value:t.bookMessage.bookTag,callback:function(e){t.$set(t.bookMessage,"bookTag",e)},expression:"bookMessage.bookTag"}})],1),e("span",{staticClass:"input__label"},[t._v("書籍標籤")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.bookTag))])]),e("div",{staticClass:"input",on:{click:function(e){return t.getDescription("book")}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.description,expression:"bookMessage.description"}],staticClass:"input__field",attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:t.bookMessage.description},on:{input:function(e){e.target.composing||t.$set(t.bookMessage,"description",e.target.value)}}}),e("span",{staticClass:"input__label"},[t._v("書籍介紹")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.description))])]),e("div",{staticClass:"input"},[e("div",{staticClass:"input__field d-flex flex-wrap flex-column"},[e("UploadPicture",{attrs:{images:t.images,originContentImages:t.bookMessage.contentPagePhoto},on:{"files-selected":t.handleImages}})],1),e("span",{staticClass:"input__label"},[t._v("圖片")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.photo))])]),e("div",{staticClass:"input"},[e("div",{staticClass:"input__field d-flex flex-wrap flex-column"},[e("UploadPdf",{attrs:{nowfile:t.pdfFile,originPdf:!0,serialNumber:t.bookMessage.serialNumber},on:{"file-selected":t.handlePdf}})],1),e("span",{staticClass:"input__label"},[t._v("書籍pdf檔")])])]),e("div",{staticClass:"col-lg-6 col-12 p-2"},[e("h2",[t._v("出版資料")]),e("div",{staticClass:"input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.code,expression:"bookMessage.code"}],staticClass:"input__field",attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:t.bookMessage.code},on:{input:function(e){e.target.composing||t.$set(t.bookMessage,"code",e.target.value)}}}),e("span",{staticClass:"input__label"},[t._v("出版社代號")])]),e("div",{staticClass:"input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.nowPublisher.name,expression:"nowPublisher.name"}],staticClass:"input__field",attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:t.nowPublisher.name},on:{input:function(e){e.target.composing||t.$set(t.nowPublisher,"name",e.target.value)}}}),e("span",{staticClass:"input__label"},[t._v("出版社名稱")])]),e("div",{staticClass:"input"},[e("div",{staticClass:"input__field d-flex flex-wrap"},[e("PickDate",{model:{value:t.bookMessage.publicationDate,callback:function(e){t.$set(t.bookMessage,"publicationDate",e)},expression:"bookMessage.publicationDate"}})],1),e("span",{staticClass:"input__label"},[t._v("出版日期")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.publicationDate))])]),e("div",{staticClass:"input"},[e("div",{staticClass:"input__field d-flex flex-wrap"},[e("TagInput",{attrs:{suggestions:[]},on:{input:function(t){}},model:{value:t.bookMessage.author,callback:function(e){t.$set(t.bookMessage,"author",e)},expression:"bookMessage.author"}})],1),e("span",{staticClass:"input__label"},[t._v("作者")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.author))])]),e("div",{staticClass:"input",on:{click:function(e){return t.getDescription("author")}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookData.authorIntro,expression:"bookData.authorIntro"}],staticClass:"input__field",attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:t.bookData.authorIntro},on:{input:function(e){e.target.composing||t.$set(t.bookData,"authorIntro",e.target.value)}}}),e("span",{staticClass:"input__label"},[t._v("作者介紹")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.authorIntro))])]),e("h2",[t._v("販售資料")]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.saleType))]),e("div",{staticClass:"input d-flex"},[e("div",{staticClass:"mt-1 input w-100"},[e("div",{staticClass:"input__field h-100 d-flex flex-wrap"},[e("div",{staticClass:"form-check col-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.entity,expression:"bookMessage.entity"}],staticClass:"form-check-input",attrs:{type:"radio",name:"entityRadio",id:"entityRadio_true"},domProps:{value:!0,checked:t._q(t.bookMessage.entity,!0)},on:{change:function(e){return t.$set(t.bookMessage,"entity",!0)}}}),e("label",{staticClass:"form-check-label",attrs:{for:"entityRadio_true"}},[t._v(" 有販售 ")])]),e("div",{staticClass:"form-check col-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.entity,expression:"bookMessage.entity"}],staticClass:"form-check-input",attrs:{type:"radio",name:"entityRadio",id:"entityRadio_false"},domProps:{value:!1,checked:t._q(t.bookMessage.entity,!1)},on:{change:function(e){return t.$set(t.bookMessage,"entity",!1)}}}),e("label",{staticClass:"form-check-label",staticStyle:{"white-space":"nowrap"},attrs:{for:"entityRadio_false"}},[t._v(" 無販售 ")])])]),e("span",{staticClass:"input__label"},[t._v("實體書")])]),t.bookMessage.entity?e("div",{staticClass:"mt-1 ms-1 input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.entityPrice,expression:"bookMessage.entityPrice"}],staticClass:"input__field h-100",attrs:{type:"number",placeholder:""},domProps:{value:t.bookMessage.entityPrice},on:{input:function(e){e.target.composing||t.$set(t.bookMessage,"entityPrice",e.target.value)}}}),e("span",{staticClass:"input__label"},[t._v("定價")])]):t._e(),t.bookMessage.entity?e("div",{staticClass:"mt-1 ms-1 input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.stock,expression:"bookMessage.stock"}],staticClass:"input__field h-100",attrs:{type:"number",placeholder:""},domProps:{value:t.bookMessage.stock},on:{input:function(e){e.target.composing||t.$set(t.bookMessage,"stock",e.target.value)}}}),e("span",{staticClass:"input__label"},[t._v("庫存")])]):t._e()]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.entityPrice))]),e("div",{staticClass:"input d-flex justify-content-between"},[e("div",{staticClass:"mt-1 input flex-grow-1"},[e("div",{staticClass:"input__field h-100 d-flex flex-wrap"},[e("div",{staticClass:"form-check col-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.ebook,expression:"bookMessage.ebook"}],staticClass:"form-check-input",attrs:{type:"radio",name:"eBookRadio",id:"eBookRadio_true"},domProps:{value:!0,checked:t._q(t.bookMessage.ebook,!0)},on:{change:function(e){return t.$set(t.bookMessage,"ebook",!0)}}}),e("label",{staticClass:"form-check-label",attrs:{for:"eBookRadio_true"}},[t._v(" 有販售 ")])]),e("div",{staticClass:"form-check col-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.ebook,expression:"bookMessage.ebook"}],staticClass:"form-check-input",attrs:{type:"radio",name:"eBookRadio",id:"eBookRadio_false"},domProps:{value:!1,checked:t._q(t.bookMessage.ebook,!1)},on:{change:function(e){return t.$set(t.bookMessage,"ebook",!1)}}}),e("label",{staticClass:"form-check-label",attrs:{for:"eBookRadio_false"}},[t._v(" 無販售 ")])])]),e("span",{staticClass:"input__label"},[t._v("電子書")])]),t.bookMessage.ebook?e("div",{staticClass:"mt-1 ms-1 input flex-grow-1"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.bookMessage.ebookPrice,expression:"bookMessage.ebookPrice"}],staticClass:"input__field h-100",attrs:{type:"number",placeholder:""},domProps:{value:t.bookMessage.ebookPrice},on:{input:function(e){e.target.composing||t.$set(t.bookMessage,"ebookPrice",e.target.value)}}}),e("span",{staticClass:"input__label"},[t._v("定價")])]):t._e()]),e("small",{staticClass:"errorhint"},[t._v(t._s(t.errorHint.ebookPrice))])]),e("div",{staticClass:"col-lg-12 col-12 p-1 d-flex flex-row-reverse"},[e("button",{on:{click:function(e){return t.fixBook()}}},[t._v("送出")])])])])])},n=[],r=s(7797),c=s(902),d=s(3753),u=s(2187),p=s(3954),h=s(8704),b={name:"FixBook",props:{bookDataFromView:{type:Object,required:!0},bookMessageFromView:{type:Object,required:!0}},components:{TagInput:r.A,SelectInput:c.A,PickDate:d.A,UploadPicture:u.A,UploadPdf:p.A},data(){return{bookData:this.bookDataFromView,bookMessage:this.bookMessageFromView,nowPublisher:{},images:[],typeList:{},nowSubTypesInfo:[],errorHint:{name:"",type:"",subTypes:"",author:"",code:"",photo:"",publicationDate:"",description:"",bookTag:"",authorIntro:"",stock:"",entityPrice:"",ebookPrice:"",saleType:""},qualified:"",pdfFile:null}},computed:{},methods:{getTypeList(){this.typeList=this.$store.state.generalInfo.typeList,this.nowSubTypesInfo=this.typeList[this.bookMessage.type].subTypes},changeTypeRadio(t){this.bookMessage.subTypes=[],this.nowSubTypesInfo=this.typeList[t].subTypes},handleDatePick(t){this.bookMessage.publicationDate=t},handleImages(t){this.images=t},handlePdf(t){this.pdfFile=t},getDescription(t){let e="";e="book"==t?this.bookMessage.description:this.bookData.authorIntro,this.$swal.fire({title:"請填寫介紹內文",html:`<textarea id="swal-textarea" style="height: 300px;width:100%">${e}</textarea>`,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",didOpen:()=>{const e=this.$swal.getPopup().querySelector("#swal-textarea");e.value="book"==t?this.bookMessage.description:this.bookData.authorIntro},preConfirm:()=>{const e=this.$swal.getPopup().querySelector("#swal-textarea").value;return e||this.$swal.showValidationMessage("內容不可空白"),e.length>2e3&&this.$swal.showValidationMessage("內容不可超過2000個字符"),"book"==t?(this.bookMessage.description=e,e):(this.bookData.authorIntro=e,e)}}).then((t=>{}))},checkBookData(){let t=!0;return""===this.bookMessage.name?(this.errorHint.name="書名不可為空",t=!1):this.bookMessage.name.length>100?(this.errorHint.name="書名長度不可大於100個字符串",t=!1):this.errorHint.name="",""===this.bookMessage.type?(this.errorHint.type="請選擇主類型",t=!1):this.errorHint.type="",0===this.bookMessage.subTypes.length?(this.errorHint.subTypes="請至少選擇一項子類型",t=!1):this.errorHint.subTypes="",this.bookMessage.bookTag.length>15?(this.errorHint.bookTag="標籤數量不得超過15個",t=!1):this.errorHint.bookTag="",""===this.bookMessage.description?(this.errorHint.description="書籍介紹不可為空",t=!1):this.errorHint.description="",0===this.images.length&&0===this.bookMessage.contentPagePhoto.length?(this.errorHint.photo="請至少放上一張圖片",t=!1):this.errorHint.photo="",""===this.bookMessage.publicationDate?(this.errorHint.publicationDate="出版日期不可為空",t=!1):this.errorHint.publicationDate="",this.bookMessage.author.length>6?(this.errorHint.author="作者人數不得超過6個",t=!1):0===this.bookMessage.author.length?(this.errorHint.author="作者人數不得為0",t=!1):this.errorHint.author="",""===this.bookData.authorIntro&&(this.errorHint.authorIntro="作者介紹不可為空",t=!1),this.bookMessage.entity||this.bookMessage.ebook?this.errorHint.saleType="":this.errorHint.saleType="請至少選擇一種販售方式",this.bookMessage.entity&&0==this.bookMessage.entityPrice?(this.errorHint.entityPrice="價格不可為0",t=!1):this.errorHint.entityPrice="",this.bookMessage.ebook&&0==this.bookMessage.ebookPrice?(this.errorHint.ebookPrice="價格不可為0",t=!1):this.errorHint.ebookPrice="",this.qualified=0==t?"":"資料格式合格",t},fixBook(){this.checkBookData()&&(this.updateLastUpdateTime(),this.bookMessage.status="審核中",this.bookMessage.read=!1,this.bookData.name=this.bookMessage.name,this.$swal.fire({title:"處理中...",text:"正在上傳資料，請稍候",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,showCancelButton:!1,didOpen:()=>{this.$swal.showLoading(),this.fixToFirebase().then((()=>{this.$swal.close(),this.$swal.fire({title:"成功",text:"資料已成功上傳，請等待管理員審核",icon:"success",confirmButtonText:"確定",showCancelButton:!1})})).then((t=>{this.$emit("closeModal")})).catch((t=>{this.$swal.close(),this.$swal.fire({title:"錯誤",text:"上傳過程中發生錯誤，請稍後重試",icon:"error",confirmButtonText:"確定"}),console.error("Error in fixBook method:",t)}))}}))},updateLastUpdateTime(){const t=(new Date).toLocaleString("zh-TW",{timeZone:"Asia/Taipei",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});this.bookMessage.lastUpdateTime=t},async fixToFirebase(){try{let t="empty";0!=this.images.length&&(t=await Promise.all(this.images.map((t=>this.convertFileToBase64(t)))));let e="empty";null!=this.pdfFile&&(e=await this.convertFileToBase64(this.pdfFile));const s=await i.A.post("/uploadBookRequest",{images:t,pdf:e,serialNumber:this.bookMessage.serialNumber,bookData:this.bookData,bookMessage:this.bookMessage,code:this.$store.state.userInfo.userInfoData.code,uid:JSON.parse(h.A.get("accountInfo")).uid});if(!s.data.success)return console.error("Error uploading files:",s.data.message),Promise.reject(s.data.message);console.log("Files uploaded successfully:")}catch(t){return console.error("Error in fixBook method:",t),Promise.reject(t)}},convertFileToBase64(t){return new Promise(((e,s)=>{const a=new FileReader;a.readAsDataURL(t),a.onload=()=>e(a.result.split(",")[1]),a.onerror=t=>s(t)}))}},beforeMount(){this.nowPublisher=this.$store.state.userInfo.userInfoData,this.getTypeList()}},g=b,m=s(1656),v=(0,m.A)(g,l,n,!1,null,"4d5c612b",null),k=v.exports,_=s(8077),f={components:{FixBook:k},data(){return{showStatus:"審核中",nowPage:1,pageNumber:5,requestListData:[],typeList:{},bookDataDetail:{},selectedBookDataOutline:{},dataOutlineLoaded:!1,dataDetailLoaded:!1,showDetailType:"書籍"}},computed:{rows(){const t=4,e=[];for(let s=0;s<this.selectedBookDataOutline.contentPagePhoto.length;s+=t)e.push(this.selectedBookDataOutline.contentPagePhoto.slice(s,s+t));return e},tableData(){return this.requestListData.filter((t=>t.status===this.showStatus))},showData(){const t=(this.nowPage-1)*this.pageNumber,e=t+this.pageNumber;return this.tableData.slice(t,e)},reviewReads(){return this.requestListData.filter((t=>"審核中"===t.status&&!t.read)).length},revisionReads(){return this.requestListData.filter((t=>"待修改"===t.status&&!t.read)).length},completeReads(){return this.requestListData.filter((t=>"已完成"===t.status&&!t.read)).length}},methods:{async getRequestListData(){try{const t=await i.A.post("/getRequestList",{code:this.$store.state.userInfo.userInfoData.code});t.data.success?(this.requestListData=t.data.data,this.dataOutlineLoaded=!0):console.error("Failed to getDataList:",t.data.message)}catch(t){console.error("Error Code:",t)}},handlePageChange(t){this.nowPage=t,this.getShowData()},async showBookDetail(t,e){try{const t=await i.A.post("/getRequestListDataDetailPublisher",{serialNumber:e.serialNumber,readStatus:!0});if(t.data.success){this.bookDataDetail=t.data.data,this.selectedBookDataOutline=e,this.dataDetailLoaded=!0;const s=this.requestListData.find((t=>t.serialNumber===e.serialNumber));s&&(s.read=!0)}else console.error("Failed to getDataDetail:",t.data.message)}catch(s){console.error("Error Data SerialNumber:",s)}},async fixBookDetail(t,e){try{const t=await i.A.post("/getRequestListDataDetailPublisher",{serialNumber:e.serialNumber,readStatus:!0});if(t.data.success){this.bookDataDetail=t.data.data,console.log(t.data.data),this.selectedBookDataOutline=e,this.dataDetailLoaded=!0;const s=this.requestListData.find((t=>t.serialNumber===e.serialNumber));s&&(s.read=!0)}else console.error("Failed to getDataDetail:",t.data.message)}catch(s){console.error("Error Data SerialNumber:",s)}},deleteAddBook(t,e){this.$swal.fire({title:"確認删除",text:`您確定要删除序列號為 ${e.serialNumber} 的請求嗎?`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",reverseButtons:!0}).then((t=>{t.isConfirmed?this.$swal.fire({title:"處理中...",text:"正在刪除請求，請稍候",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,showCancelButton:!1,didOpen:()=>{this.$swal.showLoading(),this.deleteToFirebase(e.serialNumber).then((()=>{this.$swal.close(),this.$swal.fire({title:"成功",text:"資料已成功刪除",icon:"success",confirmButtonText:"確定",showCancelButton:!1}).then((t=>{if(t.isConfirmed){const t=this.requestListData.findIndex((t=>t.serialNumber===e.serialNumber));-1!==t&&this.requestListData.splice(t,1)}}))})).catch((t=>{this.$swal.close(),this.$swal.fire({title:"錯誤",text:"刪除過程中發生錯誤，請稍後重試",icon:"error",confirmButtonText:"確定"}),console.error("Error in deleteToFirebase method:",t)}))}}):console.log("删除操作已取消")}))},async deleteToFirebase(t){try{const e=await i.A.post("/deleteRequest",{serialNumber:t});if(!e.data.success)return console.error("Error delete files:",e.data.message),Promise.reject(e.data.message);console.log("Files delete successfully:")}catch(e){return console.error("Error in delete method:",e),Promise.reject(e)}},getTypeList(){this.typeList=this.$store.state.generalInfo.typeList},closeModal(t){this.dataDetailLoaded=!1,this.bookDataDetail={};var e=document.getElementById(t),s=_.aF.getInstance(e);s.hide()},async getInit(){await this.getRequestListData(),this.getTypeList()}},beforeMount(){this.getInit()}},C=f,y=(0,m.A)(C,a,o,!1,null,"76b1ad2a",null),w=y.exports}}]);
//# sourceMappingURL=921.7b7d5b26.js.map