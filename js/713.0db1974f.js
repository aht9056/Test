"use strict";(self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[]).push([[713],{4713:function(t,e,a){a.r(e),a.d(e,{default:function(){return v}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container layout"},[e("div",{staticClass:"row gx-0"},[e("div",{staticClass:"col-lg-2 col-md-12 col-sm-12 h-auto filter_area",attrs:{id:"filterArea"}},[e("div",{staticClass:"d-flex justify-content-center text-center flex-column content p-1 row gx-0",staticStyle:{"border-radius":"10px"}},[e("span",{staticClass:"fs-6",attrs:{"data-bs-toggle":"collapse",id:"collapseBtn_filter",href:"#collapse_filter",role:"button","aria-controls":"collapse_filter"},on:{click:function(e){return t.toggleFilterCollapse()}}},[t._v(" 種類篩選/搜尋"),e("i",{staticClass:"el-icon-caret-bottom",attrs:{id:"icon_filter"}})]),e("div",{staticClass:"collapse w-100 col-12",attrs:{id:"collapse_filter"}},[e("div",{staticClass:"row gx-0"},[e("div",{staticClass:"p-1 d-flex justify-content-between col-12"},[e("el-input",{staticClass:"flex-grow-1",attrs:{size:"mini",placeholder:"輸入關鍵字搜尋"},model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:"searchInput"}}),e("i",{staticClass:"bi bi-search fs-5 ps-2 searchBtn",on:{click:t.handleTypeFilter}})],1),t._l(t.collapseBtnType,(function(a,s){return e("div",{staticClass:"ps-1 pe-1 col-lg-12 col-md-6 col-sm-4 col-4"},[e("div",{staticClass:"collapse_btn_type p-1 d-flex",class:{selected:a.show},attrs:{id:"collapseBtn_type_"+s,tabindex:"0"}},[e("div",[e("input",{staticClass:"menu",attrs:{"data-bs-toggle":"collapse",type:"checkbox",role:"button",id:"hamburgerBtn_"+s,href:"#collapse_type_"+s+"_subType"},on:{click:function(e){return t.toggleBtnTypeCollapse(s,!0)}}})]),e("div",{staticClass:"flex-grow-1",staticStyle:{cursor:"pointer"},attrs:{"data-bs-toggle":"collapse",href:"#collapse_type_"+s+"_subType"},on:{click:function(e){return t.toggleBtnTypeCollapse(s,!1)}}},[t._v(" "+t._s(a.name)+" ")])]),e("div",{staticClass:"collapse collapse_type_subType",attrs:{id:"collapse_type_"+s+"_subType"}},t._l(a.subTypes,(function(o,l){return e("div",{staticClass:"form-check m-0 p-1 d-flex"},[e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.checked[l],expression:"item.checked[index2]"}],staticClass:"filter_checkbox",attrs:{type:"checkbox",id:"type_"+s+"_subTypeCheck_"+l},domProps:{checked:Array.isArray(a.checked[l])?t._i(a.checked[l],null)>-1:a.checked[l]},on:{change:function(e){var s=a.checked[l],o=e.target,i=!!o.checked;if(Array.isArray(s)){var n=null,c=t._i(s,n);o.checked?c<0&&t.$set(a.checked,l,s.concat([n])):c>-1&&t.$set(a.checked,l,s.slice(0,c).concat(s.slice(c+1)))}else t.$set(a.checked,l,i)}}})]),e("label",{staticClass:"form-check-label flex-grow-1",attrs:{for:"Type_"+s+"_subTypeCheck_"+l}},[t._v(" "+t._s(o)+" ")])])})),0)])}))],2)])])]),e("div",{staticClass:"col-lg-10 col-md-12 col-sm-12"},[e("div",[t._v(" 排序: "),e("el-dropdown",{attrs:{trigger:"click"}},[e("span",{staticClass:"el-dropdown-link"},[t._v(" "+t._s(t.sort)),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.sortType,(function(a,s){return e("el-dropdown-item",{nativeOn:{click:function(e){return t.handleSortChange(a,s)}}},[t._v(t._s(a))])})),1)],1)],1),t.dataloaded?e("div",{staticClass:"booklist"},[0==t.bookListInfo.length?e("div",{staticClass:"row gx-0"},[e("div",{staticClass:"d-flex justify-content-center"},[t._v(" 暫無資料 ")])]):e("div",{staticClass:"row gx-0"},t._l(t.bookListInfo,(function(a){return e("div",{staticClass:"col-lg-12 col-md-6 col-sm-6 col-12 booklist_content"},[e("div",{staticClass:"row gx-0"},[e("div",{staticClass:"col-lg-2 col-md-6 col-sm-12 col-6 p-1 photo d-flex justify-content-center align-items-center"},[0!=a.discount?e("div",{staticClass:"badge"},[e("span",{staticClass:"fs-6"},[t._v(t._s(a.discount))]),t._v(" 折 ")]):t._e(),e("img",{attrs:{src:a.contentPagePhoto[0]}})]),e("div",{staticClass:"col-lg-10 col-md-6 col-sm-12 col-6 d-flex flex-column justify-content-evenly info"},[e("div",{staticClass:"d-flex justify-content-center title p-1"},[e("a",{attrs:{herf:"#",title:a.name}},[t._v(" "+t._s(a.name)+" ")])]),e("div",{staticClass:"d-flex description"},[e("div",[t._v(" "+t._s(a.description)+" ")])]),e("div",{staticClass:"d-flex author"},[t._v(" 作者: "),t._l(a.author,(function(a){return e("span",[t._v(t._s(a))])}))],2),e("div",{staticClass:"d-flex justify-content-end stock"},[e("span",[t._v(" 庫存: "),e("span",{staticClass:"keyword"},[t._v(t._s(a.stock))])])]),e("div",{staticClass:"d-flex justify-content-end price"},[e("span",{style:0!=a.discount?"text-decoration: line-through; text-decoration-color: red;":""},[t._v("售價:"),e("span",{staticClass:"keyword",style:{color:0!=a.discount?"#FF2D2D":""}},[t._v(t._s(a.entity?a.entityPrice:a.ebookPrice))]),t._v("元")]),e("span",{directives:[{name:"show",rawName:"v-show",value:0!=a.discount,expression:"item.discount != 0"}]},[t._v(" 優惠價: "),e("span",{staticClass:"keyword",staticStyle:{color:"#ff2d2d"}},[t._v(" "+t._s(a.entity?(a.entityPrice*a.discount/100).toFixed(0):(a.ebookPrice*a.discount/100).toFixed(0))+" ")]),t._v(" 元 ")])]),e("div",{staticClass:"d-flex justify-content-between align-items-end other"},[e("div",{staticClass:"d-flex"},t._l(a.bookTag,(function(a){return e("span",{staticClass:"book_tag"},[t._v(" #"+t._s(a)+"  ")])})),0),e("div",{staticClass:"d-flex"},t._l(a.saleTag,(function(a){return e("span",{staticClass:"sale_tag"},[t._v(" #"+t._s(a)+"  ")])})),0),t._m(0,!0)])])])])})),0)]):t._e(),t.dataloaded?e("div",[e("pagination",{attrs:{totalPages:t.totalPages},on:{"page-changed":t.handlePageChange},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1):e("div",[t._m(1)])])])])},o=[function(){var t=this,e=t._self._c;return e("button",{staticClass:"shoppingCar_btn"},[e("i",{staticClass:"bi bi-cart2"}),t._v(" 加入購物車 ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"loading-overlay"},[e("div",{staticClass:"loading-spinner-container"},[e("div",{staticClass:"loading-spinner"})]),e("div",{staticClass:"loading-text"},[t._v("資料載入中...")])])}],l=a(2928),i=a(9470),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pagination-container"},[e("button",{attrs:{title:"最前頁",disabled:1===t.currentPage},on:{click:t.goToFirstPage}},[t._v(" << ")]),e("button",{attrs:{title:"上一頁",disabled:1===t.currentPage},on:{click:t.goToPreviousPage}},[t._v(" < ")]),t.startPage>1?e("button",{staticClass:"page-button",on:{click:function(e){return t.goToPage(1)}}},[t._v(" 1 ")]):t._e(),t.startPage>2?e("span",[t._v("...")]):t._e(),t._l(t.visiblePages,(function(a){return e("button",{key:a,class:["page-button",{active:t.currentPage===a}],attrs:{disabled:t.currentPage===a},on:{click:function(e){return t.goToPage(a)}}},[t._v(" "+t._s(a)+" ")])})),t.endPage<t.totalPages-1?e("span",[t._v("...")]):t._e(),t.endPage<t.totalPages?e("button",{staticClass:"page-button",on:{click:function(e){return t.goToPage(t.totalPages)}}},[t._v(" "+t._s(t.totalPages)+" ")]):t._e(),e("button",{attrs:{title:"下一頁",disabled:t.currentPage===t.totalPages},on:{click:t.goToNextPage}},[t._v(" > ")]),e("button",{attrs:{title:"最末頁",disabled:t.currentPage===t.totalPages},on:{click:t.goToLastPage}},[t._v(" >> ")])],2)},c=[],r=(a(4114),{props:{value:{type:Number,default:1},totalPages:{type:Number,default:1}},data(){return{maxVisiblePages:5}},computed:{currentPage(){return this.value},startPage(){return Math.max(this.currentPage-Math.floor(this.maxVisiblePages/2),1)},endPage(){return Math.min(this.startPage+this.maxVisiblePages-1,this.totalPages)},visiblePages(){const t=[];for(let e=this.startPage;e<=this.endPage;e++)t.push(e);return t}},methods:{goToPage(t){if(t>=1&&t<=this.totalPages){const e=t>this.currentPage;this.$emit("input",t),this.$emit("page-changed",t,e)}},goToFirstPage(){this.goToPage(1)},goToLastPage(){this.goToPage(this.totalPages)},goToPreviousPage(){this.goToPage(this.currentPage-1)},goToNextPage(){this.goToPage(this.currentPage+1)}}}),d=r,u=a(1656),g=(0,u.A)(d,n,c,!1,null,"061a04aa",null),h=g.exports;a(4599);var p={components:{pagination:h},data(){return{collapseFilterStatus:!1,collapseBtnType:[],bookListInfo:[],sortType:["最多瀏覽","熱銷中","最早發行","最晚發行"],sort:"最多瀏覽",sortValue:"views",lastDocId:null,dataloaded:!1,totalDataCount:0,totalPages:1,onePageShowDataCount:2,currentPage:1,searchInput:"",algoliaClient:null,algoliaIndex:null}},methods:{toggleFilterCollapse(){this.collapseFilterStatus=!this.collapseFilterStatus;let t=document.getElementById("icon_filter");this.collapseFilterStatus?t.style.transform="rotate(0deg)":t.style.transform="rotate(-90deg)"},toggleBtnTypeCollapse(t,e){if(this.collapseBtnType[t].show=!this.collapseBtnType[t].show,!e){const e=document.getElementById("hamburgerBtn_"+t);e.checked=!e.checked}},async getFilterType(){try{const t=await i.A.get("/getTypeList");if(t.data.success){let e=Object.entries(t.data.typeList).map((([t,e])=>({id:t,...e})));this.collapseBtnType=e.map((t=>({...t,show:!1,checked:new Array(t.subTypes.length).fill(!1)})))}}catch(t){return console.error("Error fetching type list:",t),null}},handleTypeFilter(){let t=[];t=this.collapseBtnType.flatMap((t=>t.subTypes.filter(((e,a)=>t.checked[a])))),""!=this.searchInput?(this.dataloaded=!1,this.getDataFromAlgolia(0,this.onePageShowDataCount-1,"views",t)):(this.dataloaded=!1,this.getDataFromDb(0,this.onePageShowDataCount-1,"views",null,t))},handleSortChange(t,e){let a=[];a=this.collapseBtnType.flatMap((t=>t.subTypes.filter(((e,a)=>t.checked[a])))),this.currentPage=1,this.lastDocId=null,this.sort=t,this.sortValue=0==e?"views":1==e?"sold":2==e?"earliest":"latest",""!=this.searchInput?this.getDataFromAlgolia(0,this.onePageShowDataCount-1,this.sortValue,a):this.getDataFromDb(0,this.onePageShowDataCount-1,this.sortValue,null,a)},async getDataFromDb(t,e,a,s=null,o=[]){try{const l=await i.A.post("/getBookListByOrder",{dataStart:t,dataEnd:e,orderType:a,lastDocId:s,subTypes:o});l.data.success?(console.log("Data fetched successfully:"),this.bookListInfo=l.data.data,this.lastDocId=l.data.lastDocId,this.dataloaded=!0,this.totalPages=Math.ceil(l.data.totalCount/this.onePageShowDataCount),this.totalDataCount=l.data.totalCount):console.error("Error fetching data:",l.data.message)}catch(l){console.error("Error in getDataFromDb method:",l)}},async getDataFromAlgolia(t,e,a,s=[]){try{const o=await(0,l.C)(this.searchInput);if(o){let l=o[0].hits;console.log("搜索完成:",o[0].hits),s.length>0&&(l=l.filter((t=>t.subTypes&&t.subTypes.some((t=>s.includes(t)))))),console.log("篩選完成:",l),l.sort(((t,e)=>"views"===a?e.views-t.views:"sold"===a?e.sold-t.sold:"earliest"===a?new Date(t.publicationDate)-new Date(e.publicationDate):"latest"===a?new Date(e.publicationDate)-new Date(t.publicationDate):0)),this.totalDataCount=l.length,this.totalPages=Math.ceil(l.length/this.onePageShowDataCount),l=l.slice(t,e+1),this.bookListInfo=l,console.log(l)}else console.error("未返回搜索结果")}catch(o){console.error("從 Algolia 獲取數字發生錯誤:",o.message)}finally{this.dataloaded=!0}},handlePageChange(t,e){let a=[];a=this.collapseBtnType.flatMap((t=>t.subTypes.filter(((e,a)=>t.checked[a])))),this.dataloaded=!1;let s=this.onePageShowDataCount*(t-1),o=this.onePageShowDataCount*t-1;o>this.totalDataCount-1&&(o=this.totalDataCount-1),""!=this.searchInput?this.getDataFromAlgolia(s,o,this.sortValue,a):e?this.getDataFromDb(s,o,this.sortValue,this.lastDocId,a):this.getDataFromDb(s,o,this.sortValue,null,a)}},beforeMount(){this.getFilterType(),this.getDataFromDb(0,this.onePageShowDataCount-1,this.sortValue)},mounted(){this.$parent.observeNavbarHeight()}},f=p,_=(0,u.A)(f,s,o,!1,null,"5dbb8b0e",null),v=_.exports}}]);
//# sourceMappingURL=713.0db1974f.js.map